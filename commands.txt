cd Python\Django\TestAppDj
virtualenv venv
venv\Scripts\activate.bat
python -m pip install -U pip
django-admin startproject TestApp
python manage.py runserver
python manage.py startapp news # создание модуля
---------
MVC = MTV (Django)
Model = Model
View = Template
Controller = View
---------

python manage.py makemigrations # создание миграции
python manage.py migrate # выполнение миграции
python manage.py shell # консоль для заполнения БД
python manage.py collectstatic


# INSERT:
1) news4= News.objects.create(title='Новость 4',content='Контент новости 4')
2) news2=News(title='Новость 2', content='Контент новости 2')
   news2.save()
3) News.objects.create(title='Новость 5',content='Контент новости 5')

# SELECT:
News.objects.all() # все данные
News.objects.filter(title='Новость 3')
News.objects.get(pk=5) # вернет только одну запись (возможны исключения, нкобходимо точно знать, что запись 1)
News.objects.exclude(pk=5) # все, за исключением
News.objects.order_by('-pk') # сортировка

news5.save()
news5.delete()

# django.views.generic - модуль

# все данные связанные с первичной моделью
<объект>.<имя связанной модели>_set.all()

# фильтры
<имя поля>__<фильтр>

<объект>.<имя связанной модели>_set.exists() # существует ли?

<объект>.<имя связанной модели>_set.count() # кол-во записей

<объект>.get_previous_by_<имя поля>() # предъыдущая запись

<объект>.filter(<имя поля внешнкго ключа>__<имя поля первичной модели>=<''>)

# логические операции - нужен модуль Q
from django.db.models import Q
News.objects.filter(Q(pk__in=[5,6]) | Q(title__contains='2'))

---------
>>> News.objects.all()[:3]
<QuerySet [<News: Новость из формы 6>, <News: Новость из формы 5>, <News: Новость из формы
 4>]>
>>> News.objects.all()[10:]
<QuerySet [<News: Новость 1>]>
>>> News.objects.all()[3:5]
<QuerySet [<News: Новость из формы 3>, <News: Новость из формы 2>]>
---------
# Агрегатные ф-ии
from django.db.models import *

News.objects.aggregate(Min('views'), Max('views'))
 News.objects.aggregate(cnt=Count('views', distinct=True))
{'cnt': 9}

News.objects.aggregate(min_views=Min('views'),max_views= Max('views'))

---------
#  HAVING; GROUP BY
>>> cats = Category.objects.annotate(Count('news'))
>>> for item in cats:
...     print(item.title, item.news__count)
...
Культура 3
Спорт 3
Политика 3
Наука 2

# Максимальное кол-во просмотров у группы полей Категория
>>> cats = Category.objects.annotate(max_views=Max('news__views'))
>>> for item in cats:
...     print(item.title, item.max_views)
...
Культура 10
Спорт 153
Политика 1000
Наука 100

# С фильтрацией и без
>>> cats = Category.objects.annotate(cnt=Count('news')).filter(cnt__gt=0)
>>> for item in cats:
...     print(item.title, item.cnt)
...
Культура 3
Спорт 3
Политика 3
Наука 2
>>> cats = Category.objects.annotate(cnt=Count('news'))
>>> for item in cats:
...     print(item.title, item.cnt)
...
Культура 3
Спорт 3
Политика 3
Наука 2
Музыка 0

# Класс F
>>> news.views = F('views')+1
>>> news.save()

>>> news=News.objects.filter(content__icontains=F('title'))
>>> news

>>> news=News.objects.annotate(lenght=Length('title')).all()
>>> for item in news:
...     print(item.title, item.lenght)
...
Новость из формы 6 18
Новость из формы 5 18
Новость из формы 4 18
Новость из формы 3 18
Новость из формы 2 18
Новость из формы 16
Новость из админки 18
Новость 4 9
Новость 3 9
Новость 2 9
Новость 1 9



















